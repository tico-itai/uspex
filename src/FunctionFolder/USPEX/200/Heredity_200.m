function Heredity_200(Ind_No)
global POP_STRUC
global ORG_STRUC
global OFF_STRUC
CellList = findcell(ORG_STRUC.reconstruct);
ID = ceil(rand()*size(CellList,1));
OFF_STRUC.POPULATION(Ind_No).cell = CellList(ID,:);
info_parents = struct('parent',{}, 'fracFrac', {},'dimension', {},'offset', {}, 'enthalpy', {});
searching = 1;
count = 1;
while searching
count = count + 1;
if count > 50
%disp('failed to do Heredity in 50 attempts, switch to Random');
USPEXmessage(507,'',0);
Random_200(Ind_No);
break;
end
same = 1;
while same
par_one = find (ORG_STRUC.tournament>RandInt(1,1,[0,max(ORG_STRUC.tournament)-1]));
par_two = find (ORG_STRUC.tournament>RandInt(1,1,[0,max(ORG_STRUC.tournament)-1]));
if par_one(end) ~= par_two(end)
ind1 = POP_STRUC.ranking(par_one(end));
ind2 = POP_STRUC.ranking(par_two(end));
same = 0;
end
end
goodHeritage = 0;
goodLattice = 0;
securityCheck = 0;
while goodHeritage ~=1
securityCheck = securityCheck+1;
offset=[];
bigcell=OFF_STRUC.POPULATION(Ind_No).cell;
bigcell(3)=1;
[surnumIons, Offspring, Lattice,fracFrac,dimension,offset] = heredity_surface_200(ind1,ind2, bigcell);
[bulklat,coordinates,atyp,ntyp]=supercell(ORG_STRUC.bulk_lat,ORG_STRUC.bulk_pos, ORG_STRUC.bulk_atyp , ORG_STRUC.bulk_ntyp, bigcell);
[lat,candidate,numIons,typesAList,chanAList] = makeSurface(Lattice,Offspring,surnumIons,bulklat,coordinates,atyp,ntyp,ORG_STRUC.vacuumSize(1));
[coor, composition] = getSurface(candidate, numIons, lat);
goodHeritage = distanceCheck(coor, lat, composition, ORG_STRUC.minDistMatrice);
if goodHeritage == 1
OFF_STRUC.POPULATION(Ind_No).Bulk_LATTICE=bulklat;
OFF_STRUC.POPULATION(Ind_No).Bulk_COORDINATES=coordinates;
OFF_STRUC.POPULATION(Ind_No).Bulk_typesAList=atyp;
OFF_STRUC.POPULATION(Ind_No).Bulk_numIons=ntyp;
OFF_STRUC.POPULATION(Ind_No).numIons = numIons;
OFF_STRUC.POPULATION(Ind_No).LATTICE = lat;
OFF_STRUC.POPULATION(Ind_No).COORDINATES = candidate;
OFF_STRUC.POPULATION(Ind_No).typesAList = typesAList;
OFF_STRUC.POPULATION(Ind_No).chanAList=chanAList;
OFF_STRUC.POPULATION(Ind_No).Surface_COORDINATES = Offspring;
OFF_STRUC.POPULATION(Ind_No).Surface_LATTICE = Lattice;
OFF_STRUC.POPULATION(Ind_No).Surface_numIons = surnumIons;
fracFrac = [0 fracFrac 1];
enthalpy = 0;
parents = [ind1 ind2];
ID = [];
for i = 2:length(fracFrac)
ID= [ID POP_STRUC.POPULATION(parents(i-1)).Number];
E = POP_STRUC.POPULATION(parents(i-1)).Enthalpies(end);
ratio=fracFrac(i)-fracFrac(i-1);
enthalpy = enthalpy+E*ratio;
end
info_parents(1).parent = num2str(ID);
info_parents.enthalpy  = enthalpy(end);
info_parents.enthalpy  = info_parents.enthalpy/sum(numIons);
info_parents.fracFrac  = fracFrac;
info_parents.dimension = dimension;
info_parents.offset    = offset;
OFF_STRUC.POPULATION(Ind_No).Parents = info_parents;
OFF_STRUC.POPULATION(Ind_No).howCome = 'Heredity';
disp(['Structure ' num2str(Ind_No) '  generated by heredity']);
searching=0;
end
if securityCheck>20
break
end
end
end
